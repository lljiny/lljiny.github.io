{"categories":[{"title":"Tomcat","uri":"https://lljiny.github.io/categories/tomcat/"}],"posts":[{"content":"问题 最近项目遇到一个问题， 在访问项目接口（ GET 请求 ）时， 返回 400 响应码， 且服务端报错：\n java.lang.IllegalArgumentException: Invalid character found in the request target. The valid characters are defined in RFC 7230 and RFC 3986\n 分析 谷歌翻译如下：\n 在请求目标中找到无效字符。 有效字符在 RFC 7230 和 RFC 3986 中定义\n 到底有哪些有效字符呢？ 查询 RFC 7230 和 RFC 3986 文档， 发现有 84 个有效字符可以直接使用 ：\n reserved = gen-delims / sub-delims\ngen-delims = \u0026ldquo;:\u0026rdquo; / \u0026ldquo;/\u0026rdquo; / \u0026ldquo;?\u0026rdquo; / \u0026ldquo;#\u0026rdquo; / \u0026ldquo;[\u0026rdquo; / \u0026ldquo;]\u0026rdquo; / \u0026ldquo;@\u0026rdquo;\nsub-delims = \u0026ldquo;!\u0026rdquo; / \u0026ldquo;$\u0026rdquo; / \u0026ldquo;\u0026amp;\u0026rdquo; / \u0026ldquo;'\u0026rdquo; / \u0026ldquo;(\u0026rdquo; / \u0026ldquo;)\u0026rdquo; / \u0026ldquo;*\u0026rdquo; / \u0026ldquo;+\u0026rdquo; / \u0026ldquo;,\u0026rdquo; / \u0026ldquo;;\u0026rdquo; / \u0026ldquo;=\u0026rdquo;\nunreserved = ALPHA / DIGIT / \u0026ldquo;-\u0026rdquo; / \u0026ldquo;.\u0026rdquo; / \u0026ldquo;_\u0026rdquo; / \u0026ldquo;~\u0026rdquo;\nALPHA = %x41-5A / %x61-7A ; A-Z / a-z\nDIGIT = %x30-39 ; 0-9\n 而我使用的目标 url 中的 “{”、“}”字符不在其中， 是非法的。\n解决 请求中 queryParam 不使用非法字符参数 一般情况下可以避免 GET 请求使用非法字符参数， 如： 改用 POST 请求提交包含 “{”、“}” 的 json 格式参数， 或对参数 base64 编码处理\n请求中 queryParam 使用 urlEncode 编码 前端对请求中的 queryParam 进行 urlEncode 编码处理， 如： “{” 转换为 “%7b”、 “}” 转换为 “%7d”\nTomcat 版本降级 / 配置支持特殊字符 根据 Tomcat 更新日志（7.0、 8.0、 8.5、 9.0）， 可知不同 Tomcat 版本有不同的解决方案：\n 下列 Tomcat 版本以上（包括）， 修改 Tomcat 的 server.xml 配置文件， 新增 Connector 节点属性 relaxedQueryChars=\u0026quot;{,}\u0026quot;  9.0.8 8.5.31 8.0.52 7.0.87   下列 Tomcat 版本以上（包括）， 修改 Tomcat 的 catalina.properties 配置文件，新增 tomcat.util.http.parser.HttpParser.requestTargetAllow={}  9.0.0.M12 8.5.7 8.0.39 7.0.73   其它 Tomcat 版本， 无需处理， 并没有这个新特性  Tomcat 更新日志参考关键字\n 62273: Implement configuration options to work-around specification non-compliant user agents (including all the major browsers) that do not correctly %nn encode URI paths and query strings as required by RFC 7230 and RFC 3986. (markt)\nAdd additional checks for valid characters to the HTTP request line parsing so invalid request lines are rejected sooner.\n ","id":0,"section":"posts","summary":"问题 最近项目遇到一个问题， 在访问项目接口（ GET 请求 ）时， 返回 400 响应码， 且服务端报错： java.lang.IllegalArgumentException: Invalid character found in the request target. The valid characters are defined in RFC 7230 and RFC 3986 分析 谷歌翻译如下： 在","tags":["Tomcat","problem"],"title":"Tomcat 报错：The valid characters are defined in RFC 7230 and RFC 3986","uri":"https://lljiny.github.io/2020/01/tomcat-the-valid-characters-are-defined-in-rfc-7230-and-rfc-3986/","year":"2020"}],"tags":[{"title":"problem","uri":"https://lljiny.github.io/tags/problem/"},{"title":"Tomcat","uri":"https://lljiny.github.io/tags/tomcat/"}]}